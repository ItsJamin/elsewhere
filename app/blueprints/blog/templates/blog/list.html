{% extends "base.html" %}

{% block title %}Travel Blog{% endblock %}

{% block header %}<a href="{{ url_for('main.home') }}">Travel Blog</a>{% endblock %}

{% block content %}
  <section class="posts">
    {% if posts %}
      {% for post in posts %}
        <article class="post">
          <header>
            {% if post.title %}
              <h2>{{ post.title }}</h2>
            {% endif %}
            <time datetime="{{ post.timestamp }}">{{ post.timestamp }}</time>
          </header>
          <div class="post-content">
            {{ post.content | e | replace('\n', '<br/>') | safe }}
          </div>

          {# Media rendering: images open in new tab, videos use <video> player #}
          {% if post.media %}
            {% set files = post.media.split('||') %}
            <div class="post-media {% if files|length == 1 %}single{% endif %}">
              {% for f in files %}
                <div class="media-item">
                  {% set lf = f.lower() %}
                  {% if lf.endswith('.mp4') or lf.endswith('.webm') or lf.endswith('.ogg') or lf.endswith('.mov') %}
                    <video controls preload="metadata">
                      <source src="{{ url_for('blog.uploaded_file', filename=f) }}">
                      Your browser does not support the video tag.
                    </video>
                  {% else %}
                    <a href="{{ url_for('blog.uploaded_file', filename=f) }}" target="_blank" rel="noopener">
                      <img src="{{ url_for('blog.uploaded_file', filename=f) }}" alt="media" />
                    </a>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% endif %}

        </article>
      {% endfor %}
    {% else %}
      <p>Bisher keine Beitr√§ge.</p>
    {% endif %}
  </section>

{% endblock %}
